<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <title></title>
    <link href="video-js.css" rel="stylesheet">
    
    <script>
        // default options
        ConsoleBan.init()
        // custom options
        ConsoleBan.init({
            redirect: '/404'
        })
    </script>
    <style>

        /*ウィンドウの拡大縮小を禁止する*/
        body {
            touch-action: none;
        }

        /* ナビゲーションスタイル */
        nav {
            border: solid 1px #F0F0F0;
        }


            nav ul {
                list-style-type: none;
                margin: 0;
                padding: 0;
                display: flex;
                justify-content: space-around;
            }

                nav ul li {
                    flex: 1;
                }

                    nav ul li a {
                        display: block;
                        text-align: center;
                        padding: 1vw;
                        color: #333;
                        text-decoration: none;
                    }

        #password-container {
            display: flex;
            padding: 2vh;
            justify-content: center;
            align-items: center;
        }

        .password-form {
            text-align: center;
            margin-top: 200px;
        }


        #warning {
            display: none;
            color: red;
            margin-top: -5vh;
            margin-bottom: -2%;
        }

            #warning p {
                display: flex;
                padding: 2vh;
                justify-content: center;
                align-items: center;
            }

        .hide {
            display: none;
        }


        #timer {
            font-size: 100%;
            text-align: center;
            margin-top: -2vh;
        }

        #player-container {
            display: flex;
            justify-content: center;
            height: 100vh;
        }


        .video-js {
            display: flex;
            top: 0;
            left: 0;
            width: 50%;
            height: 50%;
        }
              

        .video-js .vjs-control-bar {
            display: none;
        }

        .video-js .vjs-big-play-button {
            display: none;
        }
                       

        .video-js.vjs-has-started .vjs-poster {
            display: none;
        }

        .video-js.vjs-has-started::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            pointer-events: none;
        }

        .video-js.vjs-has-started .vjs-control-bar {
            opacity: 1;
        }

        @media (max-width: 767px) {
            /* スマートフォンではビデオプレーヤーをフル幅に表示 */
            .video-js {
                width: 100%;
                height: 25%;
            }
        }
        /*ウィンドウの回転を禁止する*/
        @media (orientation: landscape) {
            body {
                transform: rotate(0deg);
            }
        }

    </style>
</head>
<body>


    <header>
        <nav>
            <ul>
                <li><a href="http://anythingsave.html.xdomain.jp/">ホーム</a></li>
                <li><a href="http://anythingsave.html.xdomain.jp/list/">所持リスト</a></li>
                <li><a href="https://marshmallow-qa.com/anything_save">質問箱</a></li>
                <li><a href="https://forms.gle/CPqsSMUE99paWa4NA">申し込み</a></li>
            </ul>
        </nav>
    </header>

    <div id="password-container">
        <input type="password" id="password-input" placeholder="パスワードを入力">
        <button id="execute-button">ダウンロード</button>
    </div>
    <div id="warning">
        <p>パスワードが間違っています。</p>
    </div>
    <div id="countdown">
        <div id="timer"></div>
    </div>
    <div id="player-container" class="hide">
        <video id="my-video" class="video-js vjs-default-skin" width="640" height="360" poster="サムネイル.png" autoplay>
            <source id="videoSource" src="" type="video/mp4">
        </video>
        <script>
            document.getElementById("execute-button").addEventListener("click", async function () {
    var password = document.getElementById("password-input").value;
    var encryptedPassword = btoa(password); // パスワードをBase64でエンコード

    // 暗号化された動画のURL
    var etchAndDecryptVideo = "aHR0cHM6Ly9zMy5hcC1ub3J0aGVhc3QtMS1udHQud2FzYWJpc3lzLmNvbS9hazE1MjBkLWZpbGVub3ctMS9maWxlcy8yMDI0MTAyMC0wMTE5XzlmYjg2ZmVkNDY4ZGQyMzM3YzAxMGY0OTVmYzUxZjg2Lm1wNA==";

    // パスワードチェック
    if (encryptedPassword === "TmlzaGloYXRhXzAxMDk=") {
        // パスワードが一致する場合
        document.getElementById("password-container").classList.add("hide");
        document.getElementById("player-container").classList.remove("hide");
        document.getElementById("warning").style.display = "none";

        // 動画をフェッチして復号化
        await fetchAndDecryptVideo(atob(etchAndDecryptVideo)); // Base64でエンコードされたURLをデコードして渡す
    } else {
        // パスワードが一致しない場合
        document.getElementById("warning").style.display = "block";
    }
});

async function fetchAndDecryptVideo(videoUrl) {
    try {
        const response = await fetch(videoUrl);
        if (!response.ok) {
            throw new Error("動画の取得に失敗しました: " + response.statusText);
        }

        const data = await response.arrayBuffer();
        const iv = new Uint8Array(data.slice(0, 16));
        const ciphertext = new Uint8Array(data.slice(16));

        const key = CryptoJS.enc.Hex.parse('dd34716876364a02d0195e2fb9ae2d1b');

        const cipherBytes = CryptoJS.lib.WordArray.create(ciphertext);
        const ivHex = CryptoJS.enc.Hex.parse(Array.from(iv).map(b => ('0' + b.toString(16)).slice(-2)).join(''));

        const decrypted = CryptoJS.AES.decrypt(
            { ciphertext: cipherBytes },
            key,
            {
                iv: ivHex,
                mode: CryptoJS.mode.CBC,
                padding: CryptoJS.pad.Pkcs7
            }
        );

        // Blobの作成とURLの生成
        const decryptedArray = new Uint8Array(decrypted.words.map(word => [
            word >> 24, (word >> 16) & 0xff, (word >> 8) & 0xff, word & 0xff
        ]).flat());
        const decryptedBlob = new Blob([decryptedArray], { type: 'video/mp4' });
        const url = URL.createObjectURL(decryptedBlob);

        document.getElementById('videoSource').src = url;
        document.getElementById('my-video').load();
    } catch (error) {
        console.error("エラー:", error);
        document.getElementById("warning").innerText = "動画の復号化に失敗しました。";
        document.getElementById("warning").style.display = "block";
    }
}
        </script>

    </div>    
   
</body>
</html>